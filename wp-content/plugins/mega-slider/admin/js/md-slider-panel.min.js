(function(b){var a=function(d){var c=this;this.tabs=null;this.activePanel=null;this.selectedItem=null;this.mdSliderToolbar=new MdSliderToolbar(c);this.mdSliderTimeline=new MdSliderTimeline(c);this.textBoxTemplate='<div class="slider-item ui-widget-content item-text" data-top="0" data-left="0" data-width="100" data-height="50" data-borderstyle="solid" data-type="text" data-title="Text" style="width: 100px; height: 50px;"><div>Text</div><span class="sl-tl"></span><span class="sl-tr"></span><span class="sl-bl"></span><span class="sl-br"></span><span class="sl-top"></span><span class="sl-right"></span><span class="sl-bottom"></span><span class="sl-left"></span> </div>';this.imageBoxTemplate='<div class="slider-item ui-widget-content item-image" data-top="0" data-left="0" data-width="100" data-height="50" data-borderstyle="solid" style="height: auto;width: auto;" data-type="image"><img width="100%" height="100%" src="'+d+'images/image.jpg" /><span class="sl-tl"></span><span class="sl-tr"></span><span class="sl-bl"></span><span class="sl-br"></span><span class="sl-top"></span><span class="sl-right"></span><span class="sl-bottom"></span><span class="sl-left"></span></div>';this.videoBoxTemplate='<div class="slider-item ui-widget-content item-video" data-top="0" data-left="0" data-width="100" data-height="50" data-borderstyle="solid" data-type="video"><img width="100%" height="100%" src="'+d+'/images/video.jpg" /><span class="sl-tl"></span><span class="sl-tr"></span><span class="sl-bl"></span><span class="sl-br"></span><span class="sl-top"></span><span class="sl-right"></span><span class="sl-bottom"></span><span class="sl-left"></span></div>';this.tab_counter=b("#md-tabs ul.md-tabs-head li.tab-item").size();this.init=function(){c.initTab();c.initPanel();c.initSliderItem();b(document).keydown(function(k){var n=k.keyCode||k.which;var h=b(k.target).is("input, textarea, select");if(!h&&c.selectedItem!=null){switch(n){case 46:var j=c.selectedItem.data("timeline");if(j!=null){j.remove();c.selectedItem.remove();c.triggerChangeSelectItem()}break;case 37:var m=c.selectedItem.data("left")-5;m=c.setPositionBoxLeft(c.selectedItem,m);c.mdSliderToolbar.changePositionLeft(m);break;case 38:var l=c.selectedItem.data("top")-5;l=c.setPositionBoxTop(c.selectedItem,l);c.mdSliderToolbar.changePositionTop(l);break;case 39:var m=c.selectedItem.data("left")+5;m=c.setPositionBoxLeft(c.selectedItem,m);c.mdSliderToolbar.changePositionLeft(m);break;case 40:var l=c.selectedItem.data("top")+5;l=c.setPositionBoxTop(c.selectedItem,l);c.mdSliderToolbar.changePositionTop(l);break}return false}});b(window).resize(function(){c.resizeWindow()});var g=b("#md-tabs .md-slide-image img").size(),f=0;b("#md-tabs .md-slide-image img").each(function(){f++;var h=b(this),j=new Image();j.src=h.attr("src");j.onload=function(){h.data("width",j.width).data("height",j.height);if(f==g){c.resizeBackgroundImage()}}})};this.initTab=function(){c.tabs=b("#md-tabs").tabs({activate:function(g,h){b(c.activePanel).find(".slider-item.ui-selected").removeClass("ui-selected");c.activePanel=b(h.newPanel);c.mdSliderTimeline.changeActivePanel();c.triggerChangeSelectItem();c.resizeBackgroundImage()},create:function(g,h){c.activePanel=b(h.panel);c.mdSliderTimeline.changeActivePanel();c.triggerChangeSelectItem()}});b(document).on("mouseenter",".md-tabs-head li",function(){b(this).find(".ui-icon-close").show()});b(document).on("mouseleave",".md-tabs-head li",function(){b(this).find(".ui-icon-close").hide()});b(document).on("click",".md-tabs-head span.ui-icon-close",function(){var j=b(this);var g=j.prev().attr("href");var l=JSON.parse(b(".settings input",b(g)).val());if(!confirm("Are you sure want to delete this slide? After accepting this slide will be removed completely.")){return}var k=b(this).parent().remove();var h=k.attr("aria-controls");b("#"+h).remove();b("tabs").tabs("refresh");c.tabs.tabs("option","active",0)});c.tabs.find(".ui-tabs-nav").sortable({axis:"x",stop:function(){c.tabs.tabs("refresh")}});b("#slide-setting-dlg").dialog({resizable:false,autoOpen:false,draggable:false,modal:true,width:960,open:function(){var h=b(this).data("tab");if(h){var g=b("input.panelsettings",h).val();(g!="")&&(g=JSON.parse(g));c.setSlideSettingValue(g)}},buttons:{Save:function(){var k=b(this).data("tab");if(k){var h=c.getSlideSettingValue();var g=JSON.parse(b("input.panelsettings",k).val());h=b.extend(g,h);b("input.panelsettings",k).val(JSON.stringify(h));if(h.fid){var j={action:"mega_get_bg",id:h.fid,oldId:-1,width:b("#md-settings-width").val(),height:b("#md-settings-height").val(),oldWidth:0,oldHeight:0};b.post(ajaxurl,j,function(l){b(".md-slide-image img",c.activePanel).attr("src",l)})}}b(this).dialog("close")},Cancel:function(){b(this).dialog("close")}}});b(document).on("click",".panel-settings-link",function(){b("#slide-setting-dlg").data("tab",b(this).parent().parent()).dialog("open")});b(".random-transition").click(function(){b("#navbar-content-transitions input").removeAttr("checked");for(i=0;i<3;i++){randomTran=Math.floor(Math.random()*26)+1;b("#navbar-content-transitions li:eq("+randomTran+") input").attr("checked","checked")}return false});var f=b("#md-slider").mdSlider({transitions:"fade",height:150,width:290,fullwidth:false,showArrow:true,showLoading:false,slideShow:true,showBullet:true,showThumb:false,slideShowDelay:2000,loop:true,strips:5,transitionsSpeed:1500});b("#navbar-content-transitions li").hoverIntent(function(){var h=b("input",this).attr("value");b("#md-slider").data("transitions",h);var g=b(this).position();b("#md-tooltip").css({left:g.left-230+b(this).width()/2,top:g.top-180}).show()},function(){b("#md-tooltip").hide()});b(document).on("click",".slide-choose-image-link",function(){var h=this;var g=wp.media.editor.send.attachment;wp.media.editor.send.attachment=function(j,k){b("#slide-backgroundimage").val(k.id);b("#slide-background-preview").attr("src",k.url);wp.media.editor.send.attachment=g};wp.media.editor.open()});b(document).on("click",".slide-choose-thumbnail-link",function(){var h=this;var g=wp.media.editor.send.attachment;wp.media.editor.send.attachment=function(j,k){b("#slide-thumbnail").val(k.id);b("#slide-thumbnail-preview").attr("src",k.url);wp.media.editor.send.attachment=g};wp.media.editor.open()});b(document).on("click",".panel-clone",function(){c.cloneTab(b(this).parent().parent());return false})};this.resizeWindow=function(){c.resizeBackgroundImage()};this.resizeBackgroundImage=function(){if(b(".md-slidewrap",c.activePanel).hasClass("md-fullwidth")){var m=b(".md-slide-image",c.activePanel).width(),h=b(".md-slide-image",c.activePanel).height(),g=b(".md-slide-image img",c.activePanel),j=parseInt(g.data("width")),f=parseInt(g.data("height"));if(f>0&&h>0){if((j/f)>(m/h)){var l=m-(h/f)*j;g.css({width:"auto",height:"100%"});if(l<0){g.css({left:(l/2)+"px",top:0})}else{g.css({left:0,top:0})}}else{var k=h-(m/j)*f;g.css({width:"100%",height:"auto"});if(k<0){g.css({top:(k/2)+"px",left:0})}else{g.css({left:0,top:0})}}}}};function e(f){var h=new Image();h.src=f;var g={height:h.height,width:h.width};return g}this.initSliderItem=function(){b("#md-tabs div.slider-item").each(function(){var f=b(this).getItemValues();b(this).setItemStyle(f)})};this.initPanel=function(){b("#add_tab").click(function(){c.addTab();return false});b("#md-tabs .slider-item").each(function(){b(this).data("slidepanel",c).triggerItemEvent()})};this.addTab=function(){c.tab_counter++;var k="Slide "+c.tab_counter,f="tabs-"+c.tab_counter;var h=b('<div id="'+f+'"></div>');h.append(b("#dlg-slide-setting").html()).data("timelinewidth",b("input[name=default-timelinewidth]").val());b("#md-tabs").append(h);var g=b('<li class="tab-item first clearfix"><a class="tab-link" href="#'+f+'"><span class="tab-text">'+k+'</span></a> <span class="ui-icon ui-icon-close">Remove Tab</span></li>');g.appendTo("#md-tabs .ui-tabs-nav");var j=b("#md-tabs .ui-tabs-nav li").index(g);c.tabs.tabs("refresh");c.tabs.tabs("option","active",j)};this.cloneTab=function(g){c.addTab();b("#tabs-"+c.tab_counter).find(".md-slide-image").html(g.find(".md-slide-image").html());var f=b.stringToObject(b("input.panelsettings",g).val());f.slide_id=-1;b("#tabs-"+c.tab_counter+" input.panelsettings").val(b.objectToString(f));b("#tabs-"+c.tab_counter).data("timelinewidth",g.data("timelinewidth"));c.mdSliderTimeline.setTimelineWidth(g.data("timelinewidth"));b(".slider-item",g).each(function(){c.cloneBoxItem(b(this))})};this.cloneBoxItem=function(f){var j=b(f).getItemValues();if(j&&c.activePanel!=null){var h,g=j.type;if(g=="text"){h=b(c.textBoxTemplate).clone()}else{if(g=="image"){h=b(c.imageBoxTemplate).clone()}else{h=b(c.videoBoxTemplate).clone()}}h.data("slidepanel",c).appendTo(b(".md-objects",c.activePanel));h.setItemValues(j);h.setItemStyle(j);h.setItemHtml(j);h.triggerItemEvent();c.mdSliderTimeline.addTimelineItem(g,h);return true}};this.addBoxItem=function(f){if(this.activePanel!=null){var g;if(f=="text"){g=b(this.textBoxTemplate).clone()}else{if(f=="image"){g=b(this.imageBoxTemplate).clone()}else{g=b(this.videoBoxTemplate).clone()}}c.mdSliderTimeline.addTimelineItem(f,g);g.data("slidepanel",this).appendTo(b(".md-objects",this.activePanel)).triggerItemEvent();c.changeSelectItem(g);c.mdSliderTimeline.triggerChangeOrderItem();c.mdSliderToolbar.focusEdit();return true}return false};this.triggerChangeSelectItem=function(){if(this.activePanel==null){return}var f=b(this.activePanel).find(".slider-item.ui-selected");if(f.size()==1){this.selectedItem=f}else{this.selectedItem=null}this.mdSliderToolbar.changeSelectItem(this.selectedItem);this.mdSliderTimeline.changeSelectItem(this.selectedItem)};this.setItemAttribute=function(f,g){if(this.selectedItem!=null){switch(f){case"width":return c.setBoxWidth(this.selectedItem,g);break;case"height":return c.setBoxHeight(this.selectedItem,g);break;case"left":return c.setPositionBoxLeft(this.selectedItem,g);break;case"top":return c.setPositionBoxTop(this.selectedItem,g);break}}};this.setItemSize=function(g,f){c.setBoxWidth(this.selectedItem,g);c.setBoxHeight(this.selectedItem,f)};this.setItemBackground=function(k,l){if(this.selectedItem!=null){b(this.selectedItem).data(b.removeMinusSign(k),l);var g=b(this.selectedItem).data("backgroundcolor");if(g&&g!=""){var j=parseInt(b(this.selectedItem).data("backgroundtransparent"));var h=b.HexToRGB(g);j=j?j:100;var f="rgba("+h.r+","+h.g+","+h.b+","+(j/100)+")";this.selectedItem.css("background-color",f)}else{this.selectedItem.css("backgroundColor","transparent")}}return false};this.setItemFontSize=function(f,g){if(this.selectedItem!=null){b(this.selectedItem).data(b.removeMinusSign(f),g);this.selectedItem.css(f,g+"px")}};this.setItemColor=function(f){if(this.selectedItem!=null){b(this.selectedItem).data("color",f);if(f!=""){this.selectedItem.css("color","#"+f)}else{this.selectedItem.css("color","")}}};this.setItemBorderColor=function(f,g){if(this.selectedItem!=null){b(this.selectedItem).data(b.removeMinusSign(f),g);this.selectedItem.css("border-color","#"+g)}};this.setItemCssPx=function(f,g){if(this.selectedItem!=null){b(this.selectedItem).data(b.removeMinusSign(f),g);this.selectedItem.css(f,g+"px")}};this.setItemCss=function(f,g){if(this.selectedItem!=null){b(this.selectedItem).data(b.removeMinusSign(f),g);this.selectedItem.css(f,g)}};this.setItemStyle=function(g,h){if(this.selectedItem!=null){_tmpSelectedItem=this.selectedItem;b(_tmpSelectedItem).data(g,h);var f=b.map(b(".mdt-style option","#md-toolbar"),function(j){return j.value});b.each(f,function(k,j){_tmpSelectedItem.removeClass(j)});_tmpSelectedItem.addClass(h)}};this.setItemOpacity=function(f,g){if(this.selectedItem!=null){b(this.selectedItem).data(f,g);this.selectedItem.css(f,g/100)}};this.setItemTitle=function(f){if(this.selectedItem!=null){b(this.selectedItem).data("title",f);if(b(this.selectedItem).data("type")=="text"){b(this.selectedItem).find("div").html(f.replace(/\n/g,"<br />"))}this.mdSliderTimeline.changeSelectedItemTitle()}};this.setImageData=function(f,g,h){if(this.selectedItem!=null){b(this.selectedItem).data("title",g);b(this.selectedItem).data("fileid",f);b(this.selectedItem).find("img").attr("src",h).load(function(){var m=new Image();m.src=h;var l=m.width,j=m.height,n=c.activePanel.find(".md-objects").width(),k=c.activePanel.find(".md-objects").height();if(j>0&&k>0){if(l>n||j>k){if((l/j)>(n/k)){c.setItemSize(n,j*n/l)}else{c.setItemSize(l*k/j,k)}}else{c.setItemSize(l,j)}c.mdSliderToolbar.changeSelectItem(c.selectedItem)}});c.mdSliderTimeline.changeSelectedItemTitle()}};this.setItemFontWeight=function(f){if(this.selectedItem!=null){b(this.selectedItem).data("fontweight",f);this.selectedItem.css("font-weight",parseInt(f));if(isNaN(f)){this.selectedItem.css("font-style","italic")}else{this.selectedItem.css("font-style","normal")}}};this.setVideoData=function(g,f,h){if(this.selectedItem!=null){b(this.selectedItem).data("title",f);b(this.selectedItem).data("fileid",g);b(this.selectedItem).find("img").attr("src",h).load(function(){var m=new Image();m.src=h;var l=m.width,j=m.height,n=c.activePanel.find(".md-objects").width(),k=c.activePanel.find(".md-objects").height();if(j>0&&k>0){if(l>n||j>k){if((l/j)>(n/k)){c.setItemSize(n,j*n/l)}else{c.setItemSize(l*k/j,k)}}else{c.setItemSize(l,j)}c.mdSliderToolbar.changeSelectItem(c.selectedItem)}});c.mdSliderTimeline.changeSelectedItemTitle()}};this.setItemLinkData=function(f){if(this.selectedItem!=null){b(this.selectedItem).data("link",f)}};this.changeBorderPosition=function(f){if(this.selectedItem!=null){b(this.selectedItem).data("borderposition",f);var g=b(this.selectedItem).data("borderstyle");c.changeBorder(f,g)}};this.changeBorderStyle=function(g){if(this.selectedItem!=null){b(this.selectedItem).data("borderstyle",g);var f=b(this.selectedItem).data("borderposition");c.changeBorder(f,g)}};this.changeBorder=function(g,h){if(this.selectedItem!=null){var f="";if(g&1){f=h}else{f="none"}if(g&2){f+=" "+h}else{f+=" none"}if(g&4){f+=" "+h}else{f+=" none"}if(g&8){f+=" "+h}else{f+=" none"}b(this.selectedItem).css("border-style",f)}};this.changeFontFamily=function(f){if(this.selectedItem!=null){b(this.selectedItem).data("fontfamily",f);b(this.selectedItem).css("font-family",f)}};this.alignLeftSelectedBox=function(){var g=b(c.activePanel).find(".slider-item.ui-selected");if(g.size()>1){var f=10000;g.each(function(){f=(b(this).position().left<f)?b(this).position().left:f});g.each(function(){c.setPositionBoxLeft(this,f)})}};this.alignRightSelectedBox=function(){var g=b(c.activePanel).find(".slider-item.ui-selected");if(g.size()>1){var f=0;g.each(function(){var h=b(this).position().left+b(this).outerWidth();f=(h>f)?h:f});g.each(function(){c.setPositionBoxLeft(this,f-b(this).outerWidth())})}};this.alignCenterSelectedBox=function(){var g=b(c.activePanel).find(".slider-item.ui-selected");if(g.size()>1){var f=g.first().position().left+g.first().outerWidth()/2;g.each(function(){c.setPositionBoxLeft(this,f-b(this).outerWidth()/2)})}};this.alignTopSelectedBox=function(){var g=b(c.activePanel).find(".slider-item.ui-selected");if(g.size()>1){var f=10000;g.each(function(){f=(b(this).position().top<f)?b(this).position().top:f});g.each(function(){c.setPositionBoxTop(this,f)})}};this.alignBottomSelectedBox=function(){var g=b(c.activePanel).find(".slider-item.ui-selected");if(g.size()>1){var f=0;g.each(function(){thisBottom=b(this).position().top+b(this).outerHeight();f=(thisBottom>f)?thisBottom:f});g.each(function(){c.setPositionBoxTop(this,f-b(this).outerHeight())})}};this.alignMiddleSelectedBox=function(){var g=b(c.activePanel).find(".slider-item.ui-selected");if(g.size()>1){var f=g.first().position().top+g.first().outerHeight()/2;g.each(function(){c.setPositionBoxTop(this,f-b(this).outerHeight()/2)})}};this.spaceVertical=function(f){var o=b(c.activePanel).find(".slider-item.ui-selected");if(o.size()>1){f=parseInt(f);var m=o.size();for(var h=0;h<m-1;h++){for(var g=h+1;g<m;g++){if(b(o[h]).position().top>b(o[g]).position().top){var l=o[h];o[h]=o[g];o[g]=l}}}if(f>0){for(var h=1;h<m;h++){c.setPositionBoxTop(b(o[h]),b(o[h-1]).position().top+b(o[h-1]).outerHeight()+f)}}else{if(m>2){var k=0;for(var h=0;h<m-1;h++){k+=b(o[h]).outerHeight()}f=(b(o[m-1]).position().top-b(o[0]).position().top-k)/(m-1);for(var h=1;h<m-1;h++){c.setPositionBoxTop(b(o[h]),b(o[h-1]).position().top+b(o[h-1]).outerHeight()+f)}}}}};this.spaceHorizontal=function(f){var o=b(c.activePanel).find(".slider-item.ui-selected");if(o.size()>1){f=parseInt(f);var m=o.size();for(var h=0;h<m-1;h++){for(var g=h+1;g<m;g++){if(b(o[h]).position().left>b(o[g]).position().left){var l=o[h];o[h]=o[g];o[g]=l}}}if(f>0){for(var h=1;h<m;h++){c.setPositionBoxLeft(b(o[h]),b(o[h-1]).position().left+b(o[h-1]).outerWidth()+f)}}else{if(m>2){var k=0;for(var h=0;h<m-1;h++){k+=b(o[h]).outerWidth()}f=(b(o[m-1]).position().left-b(o[0]).position().left-k)/(m-1);for(var h=1;h<m-1;h++){c.setPositionBoxLeft(b(o[h]),b(o[h-1]).position().left+b(o[h-1]).outerWidth()+f)}}}}};this.setPositionBoxLeft=function(g,h){h=(h>0)?h:0;var f=b(g).parent().width()-b(g).outerWidth(true);if(h>f){h=f}b(g).css("left",h+"px");b(g).data("left",h);return h};this.setPositionBoxTop=function(f,g){g=(g>0)?g:0;var h=b(f).parent().height()-b(f).outerHeight();if(g>h){g=h}b(f).css("top",g+"px");b(f).data("top",g);return g};this.setBoxWidth=function(g,f){if(f>0){var h=b(g).parent().width()-b(g).position().left;if(f>h){f=h}b(g).width(f);b(g).data("width",f);return f}return b(g).width()};this.setBoxHeight=function(g,f){if(f>0){var h=b(g).parent().height()-b(g).position().top;if(f>h){f=h}b(g).height(f);b(g).data("height",f);return f}return b(g).height()};this.triggerChangeSettingItem=function(){c.mdSliderToolbar.changeToolbarValue()};this.changeSelectItem=function(f){b(c.activePanel).find(".slider-item.ui-selected").removeClass("ui-selected");b(f).addClass("ui-selected");this.triggerChangeSelectItem()};this.getAllItemBox=function(){return b("div.slider-item",c.activePanel)};this.changeTimelineValue=function(){c.mdSliderToolbar.changeTimelineValue()};this.setTimelineWidth=function(f){if(c.activePanel){b(c.activePanel).data("timelinewidth",f)}};this.getTimelineWidth=function(){if(c.activePanel){return b(c.activePanel).data("timelinewidth")}return null};this.getSliderData=function(){var f=[];var g=false;b("#md-tabs .ui-tabs-nav a.tab-link").each(function(){var h=b(b(this).attr("href"));if(h.size()){g=false;if(h.hasClass("ui-tabs-hide")){h.removeClass("ui-tabs-hide");g=true}var k=b.stringToObject(b("input.panelsettings",h).val());k.timelinewidth=h.data("timelinewidth");var j=[];b("div.slider-item",h).each(function(){j.push(b(this).getItemValues())});f.push({itemsetting:k,boxitems:j});if(g){h.addClass("ui-tabs-hide")}}});return f};this.getSlideSettingValue=function(){var f={fid:b("#slide-backgroundimage").val(),thumb:b("#slide-thumbnail").val()};var g=[];b("#navbar-content-transitions input:checked").each(function(){g.push(b(this).val())});f.transitions=g;return f};this.setSlideSettingValue=function(f){if(typeof f!="object"){f={}}b.extend({fid:"-1",thumb:"-1",transitions:[]},f);b("#slide-backgroundimage").val(f.fid);b("#slide-thumbnail").val(f.thumb);b("#navbar-content-transitions input").attr("checked",false);if(f&&f.transitions){b.each(f.transitions,function(j,h){b("#navbar-content-transitions input[value="+h+"]").attr("checked",true)})}b("#slide-background-preview").attr("src","data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==");if(f&&f.thumb!=-1){var g={action:"mega_get_bg",id:f.fid,oldId:-1,width:b("#md-settings-width").val(),height:b("#md-settings-height").val(),oldWidth:0,oldHeight:0};b.post(ajaxurl,g,function(h){b("#slide-background-preview").attr("src",h)})}b("#slide-thumbnail-preview").attr("src","data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==");if(f&&f.thumb!=-1){var g={action:"mega_get_bg",id:f.thumb,oldId:-1,width:b("#md-settings-width").val(),height:b("#md-settings-height").val(),oldWidth:0,oldHeight:0};b.post(ajaxurl,g,function(h){b("#slide-thumbnail-preview").attr("src",h)})}}};window.MdSliderPanel=a})(jQuery);